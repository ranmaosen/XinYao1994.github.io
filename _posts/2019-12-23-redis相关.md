---
layout:     post
title:      redis相关
subtitle:   History Blogs @ 2019/12/23
date:       2019-12-23
author:     baby joker
categories:	Java高级面试
tags:	redis Java高级面试
---
　　volatile是java虚拟机提供的轻量级的同步机制











### 1. redis 数据结构 ##

**string、hash、list、set、sorted set**





### 2. redis 持久化（rdb aof）

####  2.1 RDB（Redis DataBase）

​    ①	什么是rdb：在指定的时间间隔内将内存中的数据集快照（就是Snapshot）写入磁盘，它恢复时将快照文件直接读到内存中。

​    redis会单独创建（fork）一个子进程来进行持久化，先将数据写入到一个临时文件中，待持久化过程结束，再用这个临时文件替换上次持久化好的文件。

​    整个过程中主进程不进行任何IO操作，这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那么RDB方式要比AOF更加高效。

②	fork：fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等）数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程。

③	rdb保存：RDB保存的是dump.rdb文件

④	如何触发rdb快照：

​    1. 配置文件中默认的快照配置（冷拷贝后重新使用）。

​    2. 使用命令save或bgsave。（save时只管保存，其他不管，全部阻塞；bgsave时Redis会在后台异步进行快照操作，快照同时还可以相应客户端请求；可以通过lastsave命令来获取最后一次成功执行快照的时间。）

    3. 执行flushall命令，也会产生dump.rdb文件，但里面是空的，无意义。

⑤	如何恢复：将备份文件（dump.rdb）移动到redis安装目录并启动服务即可（CONFIG GET dir获取目录）

⑥	**优势**：适合大规模的数据恢复，对于数据完整性和一致性要求不高

⑦	**劣势**：一定的时间间隔做一次备份，redis意外down掉的话会丢失最有一次快照后的修改。

fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑

⑧	如何停止：同泰所有停止rdb保存规则的方法：redis-cli config set save “ ”

#### 2.2 AOF（Append Only File）

①	什么是aof：**以日志的形式来记录每次写操作**，将Redis执行过得所有写操作指令记录下来（读操作不记录），只允许追加文件但不可以改写文件，redis启动之初会读取该违建重新构建数据，换而言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作

### 3. SNAPSHOTTING快照

常用配置

```java
// 多少秒内改变几次则保存
save <seconds> <changes>

// 默认出厂设置
save 900 1
save 300 10
save 60  10000
    
// 禁用rdb备份
save " "
    
// 保存出错禁止写入，如果配置成no，表示你不在乎数据不一致或者有其他手段发现和控制
stop-writes-on-bgsave-error yes

// 是否启动LZF压缩算法：对存储到磁盘的快照是否进行压缩存储
rdbcompression yes

// 在存储快照后，还可以让redis使用CRC64算法来今夕数据校验，但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升可以关闭此功能
rdbchecksum yes

// 备份名称
dbfilename dump.rdb

// 目录
dir
```



